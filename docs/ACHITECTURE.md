# Архитектура проекта

Вдохновлена FSD, но адаптированы под конкретный проект

## Слои

### 1. `@app/` (Приложения)

**Назначение**:
Инициализация приложения и других точек входа, глобальные настройки, распределение дерева сборки

**✔ Можно**:

- Корневой компонент `App.tsx`
- Другие точки входа (Микрофронтенд)
- Использование провайдеров (Auth, Theme)
- Создание локальных провайдеров для этого слоя `@app/app/RouterProvider` (могут содержать свои state и адаптер, экспортируются только в родительскую компоненту)

**✖ Нельзя**:

- Бизнес-логику фич
- UI-компоненты
- Нельзя создавать CSS
- Нельзя создавать State, useState, Context

### 2. `@pages/` (Страницы)

**Назначение**:
Композиция features для конкретных маршрутов

**✔ Можно**:

- Группировать модули по группе страниц (пример: `@pages/Dataset`, `@pages/Report` ). Исключения страницы без бизнес назначения (`@pages/Main`, `@pages/NotFound`)
- Использовать routing, layouts
- Cоздавать локальные ui-state для конкретной страницы (для маленьких стейтов допускается использование useState)
- Описывать логику взаимодествия используемых модулей
- Импортировать из слоя `@features/`, `@entities/`, `@shared/`

**✖ Нельзя**:

- Создавать файлы стилей, должны использоваться переиспользуемые Layout компоненты из `@entities/` или `@shared/complex` которые должны создавать композицию фичей
- Создавать компоненты с бизнес логикой (это `@features/`)
- Создавать функции и модули с бизнес логикой (это `@entities/`)
- Создавать компоненты без бизнес логики (это `@shared/complex`)
- Создавать переиспользуемые модули, функции и сервисы (это `@shared/`)
- Создавать подкомпоненты используемые только в этом модуле `@pages/Reports/components/ReportActions` выносим такие компоненты в `@features` или `@entities`

### 3. `@features/` (Фичи)

**Назначение**:
Переиспользуемые компоненты с бизнес логикой решающие конкретную задачу (пример: Таблица профилей, редактор отчета, форма логина)

**✔ Нужно**:

- Группировать модули по бизнес сущностям (пример: `@features/DatasetTable`, `@features/ReportCard` )

**✔ Можно**:

- Импортировать из слоя `@entities/`, `@shared/`
- Импортировать другие `@features/` только то что экспортируется из файла `@features/index.ts`
- Использовать routing
- Cоздавать ui-state и controller для конкретного модуля
- Создавать подкомпоненты используемые только в этом модуле `@features/ReportCard/components/ReportCardWrapper`

**✖ Нельзя**:

- Создавать подкомпоненты второго уровня вложенности `@features/ReportCard/components/Report/components/Spinner`
- Создавать функции и модули с бизнес логикой (это `@entities/`)
- Создавать компоненты без бизнес логики (это `@shared/complex`)
- Переиспользуемые модули, функции, конфигурации и константы (это `@shared/`)
- Импорт из внутренностей соседней `@features/` можно импортировать только из `@features/index.ts`
- Создавать CSS модули (должны использоваться компоненты из `@shared/complex` или `@entities`)

**Структура файлов**:

- `{{ name }}.tsx` - основной компонент, использует `reactionObserver`
- `{{ name }}.state.ts` - состояние, расширяет `ObservableState`
- `{{ name }}.controller.ts` - контроллер, расширяет `ReactionController`
- `{{ name }}.controller.test.ts` - unit-тесты контроллера
- `{{ name }}.interfaces.ts` - интерфейсы для dependency injection (опционально)
- `{{ name }}.constants.ts` - константы фичи (опционально)
- `{{ name }}.ru.json` - локализация
- `{{ name }}.translate.ts` - функция локализации

### 4. `@entities/` (Сущности)

**Назначение**:
Переиспользуемый код с бизнес логикой

**✔ Нужно**:

- Создавать модули по бизнес сущностям (пример: `@entities/Dataset`, `@entities/Report` )

**✔ Можно**:

- Импортировать из слоя `@shared/`
- Импортировать другие `@entities/` только то что экспортируется из файла `@entities/index.ts`
- Использовать routing
- Создавать инстансы ApiService для каждой сущности `@entities/Dataset/Dataset.api.ts`
- Создавать фабрики сущностей инкапсулирующие в себе логику работы сущности (без инстансов, статических полей и методов). Инстансы могут быть созданы только в адаптерах вышестоящих слоев. `@entities/Dataset/Dataset.ts`
- Создавать React компоненты не использующие state и controller `@entities/Dataset/components/DatasetFilters`
- Создавать интерфейсы и типы для сущности `@entities/Dataset/Dataset.interfaces.ts`
- Создавать константы для сущности `@entities/Dataset/Dataset.constants.ts`

**✖ Нельзя**:

- Создавать React компоненты использующие state и controller
- Создавать подкомпоненты второго уровня вложенности `@entities/Dataset/components/DatasetLayout/components/DatasetActionsBar`
- Создавать компоненты без бизнес логики и без привязки к сущности (это `@shared/complex`)
- Переиспользуемые модули, функции, конфигурации и константы без привязки к сущности (это `@shared/`)
- Импорт из внутренностей соседней `@entities/`. Mожно импортировать только из `@entities/index.ts`

**Структура файлов**:

- `{{ name }}.api.ts` - инстанс ApiService для работы с API
- `{{ name }}.api.test.ts` - unit-тесты API (опционально)
- `{{ name }}.interfaces.ts` - интерфейсы и типы сущности
- `{{ name }}.constants.ts` - константы привязанные к сущностям (опционально)
- `{{ name }}.ts` - фабрика сущностей (опционально)
- `components/` - компоненты для отображения частей сущности (могут иметь CSS модули)
- `{{ name }}.ru.json` - локализация
- `{{ name }}.translate.ts` - функция локализации

### 5. `@shared/` (Переиспользуемое)

**Назначение**:
Переиспользуемые модули приложения: сервисы, конфиги, типы, константы, провайдеры

**✔ Можно**:

- Импортировать из слоя `@shared/` соблюдая вложенность модулей используя реэкспорты
- Cоздавать ui-state и adapter для провайдеров и сложных сервисов (провайдеры и сервисы могут иметь стейт, провайдеры только транзиентный стейт, сервисы могут быть синглтонами и выступать как глобальное состояние)
- Импортировать из внешних библиотек если нужно сделать прокси блиблиотеки
- Создавать слой проксирования ui kit `@shared/ui`
- Создавать слой для хранения компонент без бизнес назначения `@shared/complex`

**✖ Нельзя**:

- Использовать routing навигация должна осуществляться из верхних уровней
- Создавать глобальные хранилища состояния (store)

#### `@shared/complex` (Составные)

**Назначение**:
Переиспользуемые компоненты без бизнес логики и не имеющие бизнес назначения, состоящие из ui-примитивов

**✔ Можно**:

- Импортировать из слоя `@shared/`
- Импортировать другие `@shared/complex` только то что экспортируется из файла `@shared/complex/index.ts`
- Группировать модули по ui-назначению (пример: `@shared/complex/PivotTable`)
- Создавать подкомпоненты используемые только в этом модуле `@complex/PivotTable/components/BooleanCell` такие подкомпоненты могут быть реэеспортированы в `@shared/complex/index.ts` и использованы точечно на верхних слоях без родителя
- Могут использовать транзиентный стейт и адаптер но без обращений к бизнес сущностям

**✖ Нельзя**:

- Все вышеперечисленное для `@shared/`

## Структура проекта

```
├─ Dockerfile                          # Конфиг для Docker-сборки
├─ README.md                           # Описание проекта
├─ default.conf                        # Конфиг nginx для Docker-сборки
├─ eslint.config.js                    # Основной конфиг ESLint
├─ eslint.local-rules.js               # Локальные правила ESLint
├─ .lekalo_templates.yml               # Описание шаблонов для автоматической генерации модулей
├─ index.html                          # HTML-шаблон приложения
├─ package.json                        # Конфиг NodeJS проекта
├─ package-lock.json                   # Полное дерево зависимостей npm
├─ public/                             # Статические файлы
├─ src/                                # Исходный код приложения
   ├─ 1_app/                           # Слой приложений
   ├─ 2_pages/                         # Слой страниц приложения
      ├─ Main/                         # Директория файлов страницы
        ├─ Main.tsx                    # Основной файл компонента React
        ├─ Main.ru.json                # Модульный блок со значениями локализации
        ├─ Main.translate.ts           # Декларация модульной функции t i18n
        └─ index.ts                    # Декларация публичных экспортов модуля
      ├─ ...
      └─ index.ts                      # Декларация публичных экспортов слоя Features
   ├─ 3_features/                      # Слой самодостаточных переиспользуемых функциональных модулей
      ├─ Menu/                         # Директория файлов фичи
        ├─ Menu.tsx                    # Основной файл компонента React
        ├─ Menu.state.ts               # Транзиентный стейт для компоненты
        ├─ Menu.controller.ts          # Транзиентный контроллер для компоненты
        ├─ Menu.controller.test.ts     # Unit тесты контроллера
        ├─ Menu.interfaces.ts          # Интерфейсы для dependency injection (опционально)
        ├─ Menu.constants.ts           # Константы фичи (опционально)
        ├─ Menu.ru.json                # Модульный блок со значениями локализации
        ├─ Menu.translate.ts           # Декларация модульной функции t i18n
        └─ index.ts                    # Декларация публичных экспортов модуля
      ├─ ...
      └─ index.ts                      # Декларация публичных экспортов слоя Features
   ├─ 4_entities/                      # Слой описания работы сущностей (Запросы данных, маппинги, фабрики обьектов, типы)
      ├─ User/                         # Директория файлов сущности
        ├─ components/                  # Компоненты используемые для отображения (частей) этой сущности
          └─ UserCardView/             # Пример подкомпонента
            ├─ UserCardView.tsx
            ├─ UserCardView.module.css # CSS модуль для компонента
            └─ index.ts
        ├─ User.api.ts                 # Инстанс ApiService для этой сущности
        ├─ User.api.test.ts            # Unit тесты API (опционально)
        ├─ User.interfaces.ts          # Интерфейсы и типы сущности
        ├─ User.constants.ts            # Константы привязанные к сущностям (опционально)
        ├─ User.ru.json                # Модульный блок со значениями локализации
        ├─ User.translate.ts           # Декларация модульной функции t i18n
        └─ index.ts                    # Декларация публичных экспортов сущности
      ├─ ...
      └─ index.ts                      # Декларация публичных экспортов слоя Entity
   ├─ 5_shared/                        # Слой переиспользуемых модулей
      ├─ complex/                      # Переиспользуемые составные комопоненты
      ├─ ui/                           # Прокси компоненты ui kit
      ├─ constants/                    # Константы не привязанные к сущностям
      ├─ provides/                     # React провайдеры
      └─ services/                     # Сервисы
   ├─ config.json                      # Конфиг приложения
   ├─ index.tsx                        # Входная точка
   └─ vite-env.d.ts                    # Типы для Vite
├─ tsconfig.app.json                   # TS-конфиг для приложения
├─ tsconfig.json                       # Основной TS-конфиг
├─ tsconfig.node.json                  # TS-конфиг для Node.js (Vite)
└─ vite.config.ts                      # Конфигурация Vite
```
